<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
  <title>æ›¼è°·è¡Œç¨‹æŸ¥è©¢ï½œEason è‡ªç”¨ç‰ˆ</title>
  <style>
    :root{
      --bg-start: #fff5f8;
      --bg-end: #f0f7ff;
      --card-bg: #ffffff;
      --text: #2c3e50;
      --muted: #7f8c8d;

      --accent: #7aa7ff;       /* å¯¶å¯¶è— */
      --pink: #ffb7d2;         /* è‰è“ç²‰ */
      --peach: #ffd8a8;        /* èœœæ¡ƒæ©˜ */
      --lavender: #d0c4ff;     /* è–°è¡£è‰ç´« */
      --mint: #b2f2bb;         /* è–„è·ç¶  */
      --thai-teal: #1f9aa8;    /* æ³°å¼é’ç¶  */
      --thai-gold: #c9a227;    /* æ³°é‡‘ */

      --border: rgba(31, 41, 55, 0.08);
      --shadow-soft: 0 6px 18px rgba(0, 0, 0, 0.06);
      --shadow-strong: 0 12px 28px rgba(0,0,0,0.10);
      --sans: "PingFang TC", "Noto Sans TC", system-ui, -apple-system, sans-serif;
    }

    *{box-sizing:border-box; -webkit-tap-highlight-color: transparent;}
    body{
      margin:0;
      font-family:var(--sans);
      color:var(--text);
      background: linear-gradient(180deg, var(--bg-start) 0%, var(--bg-end) 100%);
      min-height: 100vh;
      overflow-x: hidden;
    }

    /* ====== Thai-ish header ====== */
    header{
      padding: 22px 16px 14px;
      position: relative;
      overflow: hidden;
      text-align:center;
    }
    header::before{
      content:"";
      position:absolute; inset:-80px -80px auto -80px;
      height: 220px;
      background:
        radial-gradient(circle at 30% 30%, rgba(201,162,39,0.35), transparent 55%),
        radial-gradient(circle at 70% 35%, rgba(180,35,24,0.28), transparent 55%),
        radial-gradient(circle at 50% 80%, rgba(31,154,168,0.18), transparent 60%),
        linear-gradient(180deg, rgba(255,255,255,0.65), rgba(255,255,255,0));
      filter: saturate(1.05);
    }
    header::after{
      content:"";
      position:absolute; inset:0;
      background:
        repeating-linear-gradient(45deg,
          rgba(201,162,39,0.10) 0px,
          rgba(201,162,39,0.10) 2px,
          rgba(255,255,255,0) 2px,
          rgba(255,255,255,0) 10px
        );
      opacity: 0.22;
      pointer-events:none;
      mix-blend-mode: multiply;
    }

    .brand{
      position: relative;
      display:inline-flex;
      flex-direction:column;
      gap:6px;
      padding: 10px 14px 12px;
      border-radius: 22px;
      border: 1px solid rgba(201,162,39,0.25);
      background: rgba(255,255,255,0.60);
      box-shadow: var(--shadow-soft);
      backdrop-filter: blur(6px);
    }
    h1{
      font-size: 24px;
      font-weight: 950;
      margin: 0;
      letter-spacing: 1.6px;
      background: linear-gradient(90deg, rgba(180,35,24,0.95), rgba(201,162,39,0.95), rgba(31,154,168,0.95));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    .sub{
      color: #4b5563;
      font-size: 12px;
      font-weight: 700;
    }
    .sub b{color:#111827}
    .topline{
      position:relative;
      margin-top: 10px;
      display:flex;
      justify-content:center;
      gap:10px;
      flex-wrap:wrap;
    }
    .pill{
      position:relative;
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 9px 12px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background:#fff;
      box-shadow: var(--shadow-soft);
      font-size: 12px;
      font-weight: 850;
      color:#374151;
    }
    .pill small{font-weight:700; color:#6b7280}
    .pill .dotx{width:8px;height:8px;border-radius:50%}
    .pill button{
      border:none;
      background:transparent;
      font: inherit;
      cursor:pointer;
      color: inherit;
      padding:0;
    }

    .wrap{max-width:1100px; margin:0 auto; padding-bottom: 70px;}

    .search-container{
      padding: 0 16px 12px;
    }
    .search-box{
      display:flex; align-items:center; gap:10px;
      background:#fff;
      border: 1px solid var(--border);
      border-radius: 18px;
      padding: 10px 12px;
      box-shadow: var(--shadow-soft);
    }
    .search-box input{
      all: unset; flex:1; font-size: 14.5px; color: var(--text);
    }
    .search-box .btn{
      border:none;
      background: linear-gradient(90deg, rgba(180,35,24,0.92), rgba(201,162,39,0.92));
      color:#fff;
      font-weight: 900;
      padding: 9px 12px;
      border-radius: 14px;
      cursor:pointer;
      box-shadow: 0 8px 18px rgba(180,35,24,0.12);
      white-space:nowrap;
    }

    .grid{
      display:block;
    }

    .day-selector{
      display:flex; overflow-x:auto;
      padding: 0 12px 10px;
      gap: 10px;
      -webkit-overflow-scrolling: touch;
    }
    .day-selector::-webkit-scrollbar { display:none; }

    .daybtn{
      flex: 0 0 118px;
      background:#fff;
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 10px 10px;
      text-align:center;
      box-shadow: var(--shadow-soft);
      cursor:pointer;
      position:relative;
      overflow:hidden;
    }
    .daybtn::before{
      content:"";
      position:absolute; inset:-20px -30px auto -30px;
      height: 68px;
      background:
        radial-gradient(circle at 25% 40%, rgba(201,162,39,0.20), transparent 60%),
        radial-gradient(circle at 75% 35%, rgba(180,35,24,0.16), transparent 62%),
        radial-gradient(circle at 55% 90%, rgba(31,154,168,0.10), transparent 60%);
      opacity:.9;
    }
    .daybtn strong{display:block; font-size: 14.5px; color: var(--thai-teal); font-weight: 950; position:relative}
    .daybtn small{font-size: 11px; color: #6b7280; font-weight: 800; position:relative}

    .daybtn.active{
      background: linear-gradient(135deg, rgba(180,35,24,0.92), rgba(201,162,39,0.88));
      border-color: rgba(201,162,39,0.45);
      box-shadow: var(--shadow-strong);
      transform: translateY(-1px);
    }
    .daybtn.active strong, .daybtn.active small{color:#fff}

    .main-panel{padding: 0 16px;}

    .meta-title{
      font-weight: 950;
      font-size: 19px;
      margin: 6px 0 2px;
      letter-spacing: .2px;
    }
    .meta-note{
      font-size: 12.5px;
      color: var(--muted);
      margin-bottom: 14px;
      line-height: 1.55;
    }

    .section-header{
      display:flex; align-items:center; gap: 10px;
      margin: 18px 0 10px;
    }
    .section-header span{
      font-weight: 950;
      font-size: 16px;
      color: #111827;
      letter-spacing: .2px;
    }
    .dot{width: 9px; height: 9px; border-radius: 50%;}
    .divider{
      height:1px;
      background: rgba(17,24,39,0.06);
      margin: 16px 0 4px;
    }

    .timeline{display:flex; flex-direction:column; gap: 12px;}
    .item-card{
      background:#fff;
      border-radius: 18px;
      border: 1px solid var(--border);
      box-shadow: var(--shadow-soft);
      text-decoration:none;
      color: inherit;
      display:block;
      overflow:hidden;
      will-change: transform;
      position:relative;
    }
    .item-card::before{
      content:"";
      position:absolute; inset:0;
      background:
        radial-gradient(circle at 20% 20%, rgba(201,162,39,0.10), transparent 55%),
        radial-gradient(circle at 80% 30%, rgba(180,35,24,0.08), transparent 60%);
      opacity: .75;
      pointer-events:none;
    }
    .item-card:active{transform: scale(0.997);}

    .item-content{
      position:relative;
      display:grid;
      grid-template-columns: 72px 1fr;
      gap: 12px;
      padding: 15px;
    }
    .time-tag{
      background: rgba(31,154,168,0.10);
      border: 1px solid rgba(31,154,168,0.18);
      border-radius: 12px;
      height: 38px;
      display:grid; place-items:center;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      font-weight: 950;
      color: rgba(31,154,168,0.98);
      font-size: 13px;
    }
    .what .w{
      font-weight: 950;
      font-size: 15.5px;
      margin-bottom: 4px;
      color:#111827;
    }
    .what .d{
      color: #6b7280;
      font-size: 13px;
      line-height: 1.5;
    }
    .item-footer{
      position:relative;
      padding: 9px 14px;
      background: rgba(249,250,251,0.85);
      border-top: 1px solid rgba(17,24,39,0.06);
      font-size: 11px;
      font-weight: 900;
      color: rgba(31,154,168,0.95);
      display:flex;
      justify-content: space-between;
      align-items:center;
    }

    .trans-steps{
      background:#fff;
      border-radius: 18px;
      border: 1px solid var(--border);
      box-shadow: var(--shadow-soft);
      padding: 6px 0;
      overflow:hidden;
      position:relative;
    }
    .trans-steps::before{
      content:"";
      position:absolute; inset:0;
      background:
        radial-gradient(circle at 15% 25%, rgba(201,162,39,0.10), transparent 56%),
        radial-gradient(circle at 75% 15%, rgba(180,35,24,0.06), transparent 65%),
        radial-gradient(circle at 60% 95%, rgba(31,154,168,0.06), transparent 70%);
      opacity: .75;
      pointer-events:none;
    }
    .trans-steps > *{position:relative;}
    .t-step{
      display:flex; gap: 12px;
      padding: 12px 16px;
      border-bottom: 1px solid rgba(17,24,39,0.06);
    }
    .t-step:last-child{border-bottom:none;}
    .t-n{
      min-width: 22px; height: 22px;
      border-radius: 50%;
      background: rgba(201,162,39,0.95);
      color:#fff;
      display:grid; place-items:center;
      font-weight: 950;
      font-size: 11px;
      margin-top: 1px;
      box-shadow: 0 8px 14px rgba(201,162,39,0.18);
    }
    .t-txt .a{font-weight: 900; font-size: 13.5px; color:#111827; display:block;}
    .t-txt .b{font-size: 12px; color:#6b7280; margin-top: 2px; line-height: 1.45;}

    /* ===== Meals ===== */
    .meals-grid{
      display:grid;
      grid-template-columns: 1fr;
      gap: 12px;
    }
    .meal-box{
      background:#fff;
      border-radius: 16px;
      padding: 18px 15px 15px;   /* FIX: give space for badge */
      border: 1px solid var(--border);
      position:relative;
      overflow: visible;          /* FIX: avoid clipping */
      box-shadow: var(--shadow-soft);
    }
    .meal-type{
      position:absolute;
      top: 10px;                 /* FIX: keep inside card */
      left: 15px;
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 10px;
      font-weight: 950;
      color:#fff;
      line-height: 1;
      letter-spacing: .4px;
      box-shadow: 0 10px 18px rgba(0,0,0,0.10);
    }
    .meal-box ul{margin: 12px 0 0; padding-left: 18px;}
    .meal-box li{margin: 8px 0; font-size: 13.5px; line-height: 1.45;}
    .meal-item-link{
      color: rgba(31,154,168,0.98);
      font-weight: 950;
      text-decoration: underline;
      cursor:pointer;
    }
    .meal-box .d{
      color:#6b7280;
      font-size: 12.5px;
      margin-top: 4px;
    }

    /* ===== Overlay sheet ===== */
    .overlay{
      position:fixed; inset:0;
      background: rgba(0,0,0,0.35);
      display:none;
      z-index: 999;
    }
    .sheet{
      position:fixed; left:0; right:0; bottom:0;
      background:#fff;
      border-top: 6px solid rgba(201,162,39,0.92);
      border-radius: 24px 24px 0 0;
      padding: 18px 16px 22px;
      display:none;
      z-index: 1000;
      max-height: 78vh;
      overflow-y: auto;
      box-shadow: 0 -20px 40px rgba(0,0,0,0.16);
    }
    .sheet.show, .overlay.show{display:block;}
    .sheet-title{
      font-weight: 950;
      font-size: 18px;
      color:#111827;
      margin-bottom: 10px;
      line-height: 1.25;
    }
    .sheet-desc{
      font-size: 14px;
      line-height: 1.75;
      white-space: pre-line;
      color:#374151;
    }
    .sheet-top{
      display:flex;
      justify-content: space-between;
      align-items:flex-start;
      gap:10px;
    }
    .closebtn{
      border:none;
      background: rgba(31,154,168,0.10);
      color: rgba(31,154,168,0.98);
      font-weight: 950;
      padding: 8px 12px;
      border-radius: 14px;
      cursor:pointer;
      white-space:nowrap;
    }
    .sheet-btns{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin: 10px 0 14px;
    }
    .sheet-btns a, .sheet-btns button{
      border:none;
      background:#f3f4f6;
      color:#111827;
      font-weight: 950;
      padding: 10px 12px;
      border-radius: 14px;
      cursor:pointer;
      text-decoration:none;
      font-size: 12.5px;
      display:inline-flex;
      align-items:center;
      gap:8px;
    }
    .sheet-btns a.primary{
      background: linear-gradient(90deg, rgba(180,35,24,0.92), rgba(201,162,39,0.92));
      color:#fff;
      box-shadow: 0 12px 22px rgba(180,35,24,0.12);
    }

    /* ===== Toast ===== */
    .toast{
      position:fixed;
      left: 50%;
      transform: translateX(-50%);
      bottom: 18px;
      background: rgba(17,24,39,0.92);
      color:#fff;
      padding: 10px 12px;
      border-radius: 14px;
      font-weight: 900;
      font-size: 12.5px;
      z-index: 1200;
      display:none;
      max-width: 92vw;
      text-align:center;
    }

    @media (min-width: 920px){
      .grid{display:grid; grid-template-columns: 260px 1fr; gap: 6px;}
      .day-selector{
        flex-direction: column;
        position: sticky;
        top: 18px;
        height: auto;
        padding: 0 0 14px 10px;
      }
      .main-panel{padding: 0 18px;}
      .meals-grid{grid-template-columns: 1fr 1fr 1fr;}
      .search-container{padding: 0 18px 12px;}
      header{padding: 24px 18px 14px;}
    }
  </style>
</head>

<body>
  <header>
    <div class="brand">
      <h1>BANGKOK TRIP</h1>
      <div class="sub"><b>Eason</b> è‡ªç”¨è¡Œç¨‹ï½œæ³°å¼é¢¨æ ¼ï¼‹ã€Œä¸Šä¸€ç«™å°èˆªã€ç‰ˆ</div>
    </div>
    <div class="topline">
      <div class="pill" title="é£¯åº—">
        <span class="dotx" style="background:rgba(31,154,168,0.95)"></span>
        <span>ğŸ¨ Metro Hotel Phahonyothin 35</span>
      </div>
      <div class="pill" title="ä»Šå¤©æ¨¡å¼">
        <span class="dotx" style="background:rgba(201,162,39,0.95)"></span>
        <button onclick="goToday()">ğŸ“Œ ä»Šå¤©æ¨¡å¼ <small id="todayHint"></small></button>
      </div>
      <div class="pill" title="æç¤º">
        <span class="dotx" style="background:rgba(180,35,24,0.95)"></span>
        <span>é»é¤å»³ â†’ Sheet â†’ã€Œå¾ä¸Šä¸€ç«™å°èˆªã€</span>
      </div>
    </div>
  </header>

  <div class="search-container">
    <div class="search-box">
      <input id="q" placeholder="å¿«é€Ÿæœå°‹ï¼šDAY / æ™¯é» / é¤å»³é—œéµå­—â€¦" oninput="handleSearch()" />
      <button class="btn" onclick="goToday()">ä»Šå¤©</button>
    </div>
  </div>

  <div class="wrap">
    <div class="grid">
      <div class="day-selector" id="daylist"></div>

      <main class="main-panel">
        <div class="meta-title" id="mainTitle"></div>
        <div class="meta-note" id="mainNote"></div>
        <div id="content"></div>
      </main>
    </div>
  </div>

  <div class="overlay" id="overlay" onclick="closeSheet()"></div>
  <div class="sheet" id="sheet">
    <div class="sheet-top">
      <div id="sheetTitle" class="sheet-title"></div>
      <button class="closebtn" onclick="closeSheet()">é—œé–‰</button>
    </div>
    <div id="sheetBtns" class="sheet-btns"></div>
    <div id="sheetDesc" class="sheet-desc"></div>
  </div>

  <div class="toast" id="toast"></div>

<script>
'use strict';

/* ======================
   Data
====================== */
const itinerary = [
  {
    id: 1,
    day: 'DAY 1',
    date: '2/9ï¼ˆä¸€ï¼‰',
    title: 'æŠµé”æ›¼è°·ï¼šè½åœ°å®‰é “',
    note: 'ä½ ç´„ 20:00 åˆ°é£¯åº—ï¼šæ™šé¤æ”¹æˆã€Œè¿‘ï¼‹åœ¨åœ°ã€ï¼›æ—©é¤/åˆé¤åœ¨å°åŒ—â†’ Ã—ã€‚',
    timeline: [
      { time: '18:10', what: 'Suvarnabhumi Airport (BKK)', desc: 'å‡ºé—œé ˜è¡Œæã€‚å»ºè­°åœ¨ BKK åœ°ä¸‹ä¸€æ¨“ ARL ç«™æ—çš„ SuperRich æ›åŒ¯ã€‚' },
      { time: '20:00', what: 'Metro Hotel Phahonyothin 35', desc: 'å…¥ä½ã€‚åœ°å€ï¼š168 Phahonyothin 35 Alley, Chatuchak, Bangkok 10900' }
    ],
    transport: {
      headline: 'æ©Ÿå ´é€²å¸‚å€è©³ç´°å‹•ç·š',
      steps: [
        { a: 'ARL Suvarnabhumi ç«™', b: 'æ­ä¹˜æ©Ÿå ´å¿«ç·šè‡³çµ‚é» Phaya Thaiã€‚' },
        { a: 'è½‰ä¹˜ BTS ç¶ ç·š', b: 'Phaya Thai â†’ å¾€ Kasetsart æ–¹å‘ â†’ Ratchayothin ä¸‹è»Šï¼Œæ­¥è¡Œå›é£¯åº—ã€‚' }
      ]
    },
    meals: {
      breakfast: [{ place: { name: 'Ã—', q: '', note: 'æ—©é¤åœ¨å°åŒ—' }, d: 'Ã—' }],
      lunch: [{ place: { name: 'Ã—', q: '', note: 'åˆé¤åœ¨å°åŒ—' }, d: 'Ã—' }],
      dinner: [
        {
          place: { name:'à¸•à¸¥à¸²à¸”à¸™à¸±à¸”à¹€à¸¡à¹€à¸ˆà¸­à¸£à¹Œ à¸£à¸±à¸Šà¹‚à¸¢à¸˜à¸´à¸™ï¼ˆMajor Ratchayothin å¤œå¸‚ï¼‰', q:'à¸•à¸¥à¸²à¸”à¸™à¸±à¸”à¹€à¸¡à¹€à¸ˆà¸­à¸£à¹Œ à¸£à¸±à¸Šà¹‚à¸¢à¸˜à¸´à¸™', note:'ä¸»é¸ï½œè¿‘é£¯åº—ç”Ÿæ´»åœˆï¼Œæ™šåˆ°ä¹Ÿåƒå¾—åˆ°' },
          d: 'ã€å¿…åƒã€‘Moo Ping è±¬è‚‰ä¸²ï¼‹ç³¯ç±³é£¯ã€Som Tam é’æœ¨ç“œæ²™æ‹‰ã€çƒ¤é­·é­š/çƒ¤è¦ã€æ³°å¥¶ã€‚\nã€é»é¤ã€‘æ€•è¾£ï¼šà¹€à¸œà¹‡à¸”à¸™à¹‰à¸­à¸¢ï¼ˆå°è¾£ï¼‰ï¼›ä¸è¾£ï¼šà¹„à¸¡à¹ˆà¹€à¸œà¹‡à¸”ã€‚',
          afterTime: '20:00'
        },
        {
          place: { name:'Suki TeeNoi Goldï¼ˆæ³°å¼å£½å–œé‹ï¼‰', q:'Suki TeeNoi Gold Major Ratchayothin', note:'å‚™æ¡ˆï½œæƒ³åè‘—åƒï¼æ·±å¤œä¿åº•' },
          d: 'ã€å¿…é»ã€‘ç¶œåˆè‚‰ç›¤ï¼‹è”¬èœï¼‹ä¸¸å­é¡ã€‚\nã€é©åˆã€‘è½åœ°ç´¯çˆ†ã€åªæƒ³å¿«é€Ÿè£œç†±é‡èˆ‡å–ç†±æ¹¯ã€‚',
          afterTime: '20:00'
        }
      ]
    }
  },

  {
    id: 2,
    day: 'DAY 2',
    date: '2/10ï¼ˆäºŒï¼‰',
    title: 'è€åŸç¶“å…¸èˆ‡é„­ç‹å»Ÿ',
    note: 'å¤§çš‡å®®æœè£é™åˆ¶åš´æ ¼ï¼ˆçŸ­è¤²çŸ­è£™ä¸è¡Œï¼‰ã€‚æ™šé¤å°±ç•™åœ¨å”äººè¡—ï¼Œä¸è·Ÿ Day1 é‡è¤‡ã€‚',
    timeline: [
      { time: '09:00', what: 'The Grand Palace', desc: 'å¤§çš‡å®®ã€‚å»ºè­°ä¸€æ—©å»é¿äººæ½®èˆ‡ç†±ã€‚' },
      { time: '13:00', what: 'Wat Pho è‡¥ä½›å¯º', desc: 'çœ‹å·¨å¤§çš„å®¤å…§é‡‘è‰²è‡¥ä½›ã€‚' },
      { time: '15:30', what: 'Wat Arun é„­ç‹å»Ÿ', desc: 'æ­æ¸¡è¼ªè·¨æ²³ï¼Œæ¬£è³ç™½è‰²ç¢ç“·æ‹¼è²¼å°–å¡”ã€‚' },
      { time: '18:30', what: 'Yaowarat Chinatown', desc: 'å”äººè¡—å¤œæ™šå®µå¤œæˆ°å ´ã€‚' }
    ],
    transport: {
      headline: 'è€åŸå€ BTS/MRT è©³ç´°è½‰ä¹˜',
      steps: [
        { a: 'å‰å¾€è€åŸ', b: 'BTS Ratchayothin â†’ Asokï¼Œè½‰ MRT Sukhumvit â†’ Sanam Chaiã€‚' },
        { a: 'è·¨æ²³æ¸¡è¼ª', b: 'Tha Tien ç¢¼é ­æ­æ¸¡è¼ªåˆ°é„­ç‹å»Ÿã€‚' },
        { a: 'å‰å¾€å”äººè¡—', b: 'MRT Sanam Chai â†’ Wat Mangkonï¼ˆå”äººè¡—ï¼‰ã€‚' }
      ]
    },
    meals: {
      breakfast: [
        {
          place: { name:'On Lok Yunï¼ˆè€æ´¾æ—©é¤ï¼‰', q:'On Lok Yun Bangkok', note:'æ—©é¤å–®é»ï½œè€åŸç¶“å…¸' },
          d: 'ã€å¿…é»ã€‘ç…è›‹ï¼‹åå¸ setã€æ³°å¼å’–å•¡ï¼ˆé»ã€Œà¸«à¸§à¸²à¸™à¸™à¹‰à¸­à¸¢ã€å°‘ç³–ï¼‰ã€‚',
          afterTime: '09:00'
        }
      ],
      lunch: [
        {
          place: { name:'Krua Apsornï¼ˆæ³°å¼ååº—ï¼‰', q:'Krua Apsorn Dinso', note:'ä¸»é¸ï½œè€åŸä¸€å¸¶' },
          d: 'ã€å¿…é»ã€‘èŸ¹è‚‰ç‚’è›‹ã€à¸›à¸¹à¸œà¸±à¸”à¸à¸£à¸´à¸à¹€à¸«à¸¥à¸·à¸­à¸‡ï¼ˆèŸ¹è‚‰ç‚’é»ƒè¾£æ¤’/é»ƒå’–å“©æ„Ÿï¼‰ã€å†¬è”­åŠŸã€‚',
          afterTime: '13:00'
        },
        {
          place: { name:'Thip Samaiï¼ˆPad Thaiï¼‰', q:'Thip Samai Pad Thai', note:'å‚™æ¡ˆï½œå¿«é€Ÿç©©å®š' },
          d: 'ã€å¿…é»ã€‘æ‹›ç‰Œ Pad Thaiï¼ˆè¦ï¼‰ã€æ©˜è‰²é®®æ¦¨æ±ã€‚',
          afterTime: '13:00'
        }
      ],
      dinner: [
        {
          place: { name:'Guay Jub Ouan Pochanaï¼ˆèƒ¡æ¤’æ²ç²‰è±¬é›œæ¹¯ï¼‰', q:'Guay Jub Ouan Pochana', note:'ä¸»é¸ï½œå”äººè¡—å®µå¤œç‹è€…' },
          d: 'ã€å¿…é»ã€‘à¸à¹‹à¸§à¸¢à¸ˆà¸±à¹Šà¸šï¼ˆèƒ¡æ¤’æ¸…æ¹¯æ²ç²‰ï¼‰ï¼‹è„†çš®äº”èŠ±/å…§è‡Ÿã€‚\nã€åƒæ³•ã€‘å…ˆå–æ¹¯æš–èƒƒï¼Œå†åŠ è¾£ç²‰/é†‹èª¿å‘³ã€‚',
          afterTime: '18:30'
        },
        {
          place: { name:'Yaowarat Toasted Breadï¼ˆç¢³çƒ¤åå¸ï¼‰', q:'Yaowarat Toasted Bread', note:'å‚™æ¡ˆï½œç”œé»æ”¶å°¾/ç¬¬äºŒæ”¤' },
          d: 'ã€å¿…é»ã€‘çˆ†æ¼¿åå¸ï¼ˆå¥¶æ²¹/å·§å…‹åŠ›/æ¤°çµ²ï¼‰ã€‚å…©äººåˆ†ä¸€ä»½å‰›å¥½ã€‚',
          afterTime: '18:30'
        }
      ]
    }
  },

  {
    id: 3,
    day: 'DAY 3',
    date: '2/11ï¼ˆä¸‰ï¼‰',
    title: 'éƒŠå€å¥‡è§€èˆ‡ SPA',
    note: 'ä»Šæ—¥è»Šç¨‹é ï¼šå»ºè­°è·Ÿåœ˜/åŒ…è»Šã€‚æ™šé–“ SPA å¾Œæ™šé¤ä»¥ã€Œå¥½ä¸‹é£¯ä½†ä¸è™èƒƒã€ç‚ºä¸»ã€‚',
    timeline: [
      { time: '08:30', what: 'Maeklong Railway Market', desc: 'ç¾åŠŸéµé“å¸‚å ´ï¼Œçœ‹ç«è»Šç©¿æ¢­å¸‚å ´ã€‚' },
      { time: '12:00', what: 'Damnoen Saduak Floating Market', desc: 'ä¸¹å«©èæœµæ°´ä¸Šå¸‚å ´ï¼Œæ­èˆ¹é«”é©—æ°´ä¸Šäº¤æ˜“ã€‚' },
      { time: '19:30', what: 'Makkha Health & Spa (Heritage Asoke)', desc: 'æŒ‰æ‘©æ”¾é¬†ï¼ˆAsoke åˆ†åº—ï¼‰ã€‚' }
    ],
    transport: {
      headline: 'éƒŠå€å¾€è¿”æŒ‡å¼•',
      steps: [
        { a: 'é›†åˆé»ç§»å‹•', b: 'å»ºè­° BTS è‡³ Siam/Asok ç­‰é›†åˆé»ï¼ˆä¾ä½ è¨‚çš„åœ˜ï¼‰ã€‚' },
        { a: 'è¿”ç¨‹ä¼‘æ¯', b: 'å›å¸‚å€å¾Œè‹¥å¡è»Šä¹…ï¼Œå›é£¯åº—æˆ–ç›´æ¥å» SPAã€‚' }
      ]
    },
    meals: {
      breakfast: [
        {
          place: { name:'Jok / Khao Tomï¼ˆæ³°å¼ç²¥åº—ï¼šå°±è¿‘æ‰¾ï¼‰', q:'à¹‚à¸ˆà¹Šà¸ à¹ƒà¸à¸¥à¹‰ Phahonyothin 35', note:'æ—©é¤å–®é»ï½œæ—©å‡ºé–€åƒç†±çš„' },
          d: 'ã€å¿…é»ã€‘à¹‚à¸ˆà¹Šà¸ï¼ˆæ³°å¼ç²¥ï¼‰ï¼‹à¹„à¸‚à¹ˆï¼ˆè›‹ï¼‰ï¼›æˆ–à¸‚à¹‰à¸²à¸§à¸•à¹‰à¸¡ï¼ˆæ¹¯æ³¡é£¯ï¼‰ã€‚\nã€ä¸è¾£ã€‘à¹„à¸¡à¹ˆà¹€à¸œà¹‡à¸”ã€‚',
          afterTime: '08:30'
        }
      ],
      lunch: [
        {
          place: { name:'Damnoen Saduakï¼ˆå¸‚å ´ç¾åƒï¼‰', q:'Damnoen Saduak Floating Market', note:'ä¸»é¸ï½œæ°´ä¸Šå¸‚å ´æ”¤ä½' },
          d: 'ã€å¿…åƒã€‘èˆ¹éºµ/ç±³ç²‰æ¹¯ã€çƒ¤è¦/çƒ¤é­šã€æ¤°å­å†°ã€‚\nã€é¸æ”¤ã€‘è·Ÿè‘—äººå¤šçš„æ”¤èµ°ã€‚',
          afterTime: '12:00'
        },
        {
          place: { name:'Maeklongï¼ˆå¸‚å ´å°åƒï¼‰', q:'Maeklong Railway Market', note:'å‚™æ¡ˆï½œæ™‚é–“å¡åœ¨ç¾åŠŸ' },
          d: 'ã€å¿…åƒã€‘çƒ¤æµ·é®®ã€æ¤°å­æ°´ã€ç¾ç…å°é»ã€‚',
          afterTime: '12:00'
        }
      ],
      dinner: [
        {
          place: { name:'Zab Oneï¼ˆä¼Šå–„èœï¼‰', q:'Zab One Bangkok', note:'ä¸»é¸ï½œå›å¸‚å€å¾Œé‡å£å‘³è£œèƒ½é‡' },
          d: 'ã€å¿…é»ã€‘Som Tamã€çƒ¤è±¬é ¸è‚‰ï¼ˆà¸„à¸­à¸«à¸¡à¸¹à¸¢à¹ˆà¸²à¸‡ï¼‰ã€Larbï¼‹ç³¯ç±³é£¯ã€‚\nã€æ€•è¾£ã€‘à¹€à¸œà¹‡à¸”à¸™à¹‰à¸­à¸¢ã€‚',
          afterTime: '19:30'
        },
        {
          place: { name:'Khao Tomï¼ˆæ¸…æ·¡å®µå¤œç²¥åº—ï¼šå°±è¿‘ï¼‰', q:'à¸‚à¹‰à¸²à¸§à¸•à¹‰à¸¡ à¹ƒà¸à¸¥à¹‰ Asok', note:'å‚™æ¡ˆï½œSPAå¾Œæƒ³æ¸…æ·¡æ”¾ç©º' },
          d: 'ã€å¿…é»ã€‘à¸‚à¹‰à¸²à¸§à¸•à¹‰à¸¡ï¼‹ç‚’èœ/è›‹ã€‚\nã€é©åˆã€‘æŒ‰æ‘©å¾Œä¸æƒ³åƒå¤ªåˆºæ¿€ã€‚',
          afterTime: '19:30'
        }
      ]
    }
  },

  {
    id: 4,
    day: 'DAY 4',
    date: '2/12ï¼ˆå››ï¼‰',
    title: 'è¨­è¨ˆæ›¼è°·èˆ‡éŠèˆ¹',
    note: 'ICONSIAM å¾ˆå¤§ï¼šä¸Šèˆ¹å‰å…ˆåƒå°ä»½é‡å¢Šè‚šå­ã€‚ç™»èˆ¹ï¼šICONSIAM 4 è™Ÿç¢¼é ­ã€‚',
    timeline: [
      { time: '11:00', what: 'TCDC Bangkok', desc: 'è¨­è¨ˆä¸­å¿ƒï¼ˆè€éƒµå±€æ”¹å»ºï¼‰ï¼Œå¤è¹ŸÃ—ç¾ä»£è¨­è¨ˆäº¤æœƒã€‚' },
      { time: '15:00', what: 'ICONSIAM', desc: 'é€› SookSiam ç¾é£Ÿå€ã€æ¡è²·ä¼´æ‰‹ç¦®ã€‚' },
      { time: '19:45', what: 'ICONSIAM Pier 4', desc: '4 è™Ÿç¢¼é ­ç™»èˆ¹ï¼ˆWhite Orchid Cruiseï¼‰ã€‚' }
    ],
    transport: {
      headline: 'æ²³å²¸è©³ç´°è·¯ç·š',
      steps: [
        { a: 'BTS è½‰ç·š', b: 'Ratchayothin â†’ Siam è½‰ Silom ç·šè‡³ Saphan Taksinã€‚' },
        { a: 'æ­æ¥é§èˆ¹', b: 'Saphan Taksin ç«™å‡ºç«™åˆ° Sathorn Pierï¼Œæ­æ¥é§èˆ¹åˆ° ICONSIAMã€‚' }
      ]
    },
    meals: {
      breakfast: [
        {
          place: { name:'Ari å’–å•¡é¤¨æ—©é¤ï¼ˆæ“‡ä¸€å°±è¿‘ï¼‰', q:'Ari cafe breakfast', note:'æ—©é¤å–®é»ï½œéƒ½æœƒæ—¥èˆ’æœè·¯ç·š' },
          d: 'ã€å¿…é»ã€‘å¯é Œ/åå¸ï¼‹è›‹ï¼‹å’–å•¡ï¼ˆä»Šå¤©èµ°å¾ˆä¹…ï¼Œæ—©é¤è¦æœ‰è›‹ç™½è³ªï¼‰ã€‚',
          afterTime: '11:00'
        }
      ],
      lunch: [
        {
          place: { name:'TCDC å‘¨é‚Šæ³°èœï¼ˆå°±è¿‘ï¼‰', q:'TCDC Bangkok restaurant', note:'ä¸»é¸ï½œä¸æ’éšŠå„ªå…ˆ' },
          d: 'ã€å¿…é»ã€‘æ‰“æ‹‹è±¬ï¼‹ç…è›‹ã€ç©ºå¿ƒèœã€å†¬è”­åŠŸã€‚\nã€åŸå‰‡ã€‘åƒå¿«ã€ç•™åŠ›çµ¦ ICONSIAMã€‚',
          afterTime: '11:00'
        },
        {
          place: { name:'Charoen Krung ç°¡é¤ï¼ˆå‚™ç”¨ï¼‰', q:'Charoen Krung restaurant', note:'å‚™æ¡ˆï½œè‹¥å‘¨é‚Šå®¢æ»¿' },
          d: 'ã€å¿…é»ã€‘ç‚’æ²³ç²‰/å’–å“©/ç‡’è‚‰é£¯é¡ã€‚\nã€åŸå‰‡ã€‘äººå¤šçš„åº—é€šå¸¸æ›´ç©©ã€‚',
          afterTime: '11:00'
        }
      ],
      dinner: [
        {
          place: { name:'SookSiamï¼ˆICONSIAM ç¾é£Ÿå€ï¼‰', q:'SookSiam ICONSIAM', note:'ä¸»é¸ï½œä¸Šèˆ¹å‰å…ˆå¢Šè‚šå­ï¼ˆå°ä»½é‡ï¼‰' },
          d: 'ã€å¿…åƒã€‘èŠ’æœç³¯ç±³é£¯ã€æ³°å¥¶ã€æ¹¯éºµ/å°åƒæ‹¼ã€‚\nã€ç­–ç•¥ã€‘ä¸è¦åƒåˆ°çˆ†æ’ï¼Œèˆ¹ä¸Šæ‰èˆ’æœã€‚',
          afterTime: '19:45'
        },
        {
          place: { name:'ICONSIAM æ²³å²¸é¤å»³ï¼ˆå‚™ç”¨ï¼‰', q:'ICONSIAM riverside restaurant', note:'å‚™æ¡ˆï½œæƒ³åè‘—åƒ/å¹å†·æ°£' },
          d: 'ã€å¿…é»ã€‘æ³°å¼çƒ¤é›/æµ·é®®ï¼‹ä¸€ä»½ä¸»é£Ÿã€‚\nã€æé†’ã€‘ç™»èˆ¹å‰æ™‚é–“æŠ“é¬†ï¼ŒPier 4 å»ºè­°ææ—©åˆ°ã€‚',
          afterTime: '19:45'
        }
      ]
    }
  },

  {
    id: 5,
    day: 'DAY 5',
    date: '2/13ï¼ˆäº”ï¼‰',
    title: 'æ–‡é’æ—¥å¸¸èˆ‡æ­¸åœ‹',
    note: 'é€±äº”å¸‚å€æ›´å®¹æ˜“å¡ï¼šè»Œé“äº¤é€šå„ªå…ˆã€‚Terminal 21 åšæœ€å¾Œæ™šé¤/æ¡è²·ã€‚',
    timeline: [
      { time: '11:00', what: 'Ari', desc: 'æ–‡é’å€ï¼šå’–å•¡å»³ã€è¨­è¨ˆå°åº—ã€‚' },
      { time: '13:30', what: 'Or Tor Kor Market', desc: 'é ‚ç´šå¸‚å ´ï¼šæ°´æœã€ç†Ÿé£Ÿå¾ˆå¼·ã€‚' },
      { time: '18:00', what: 'Terminal 21 Asok', desc: 'æœ€å¾Œæ¡è²·ï¼†æ™šé¤ï¼ˆPier 21ï¼‰ã€‚' },
      { time: '20:45', what: 'Go to Airport', desc: 'å›é£¯åº—æ‹¿è¡Œæâ†’æ©Ÿå ´å¿«ç·š/æ©Ÿå ´ã€‚' }
    ],
    transport: {
      headline: 'æ­¸åœ‹æ’¤é€€çµ•å°è·¯å¾‘',
      steps: [
        { a: 'å‰å¾€ Asok', b: 'BTS ç¶ ç·šåˆ° Asokï¼ˆTerminal 21ï¼‰ã€‚' },
        { a: 'å›é£¯åº—æè¡Œæ', b: 'Asok â†’ å› Ratchayothinã€‚' },
        { a: 'å‰å¾€æ©Ÿå ´', b: 'Ratchayothin â†’ Phaya Thai è½‰ ARL æ©Ÿå ´å¿«ç·šã€‚' }
      ]
    },
    meals: {
      breakfast: [
        {
          place: { name:'Nana Coffee Roastersï¼ˆAriï¼‰', q:'Nana Coffee Roasters Ari', note:'æ—©é¤å–®é»ï½œæ–‡é’æ—¥åƒæ¼‚äº®' },
          d: 'ã€å¿…é»ã€‘æ‰‹æ²–/æ‹¿éµï¼‹å¯é Œ/ç”œé»ï¼ˆä¾ç•¶å¤©æƒ³åƒæŒ‘ï¼‰ã€‚',
          afterTime: '11:00'
        }
      ],
      lunch: [
        {
          place: { name:'Or Tor Kor Marketï¼ˆé ‚ç´šå‚³çµ±å¸‚å ´ï¼‰', q:'Or Tor Kor Market', note:'ä¸»é¸ï½œæœ€æ›¼è°·ã€æœ€å¼·å¸‚å ´åˆé¤' },
          d: 'ã€å¿…åƒã€‘çƒ¤é›ï¼ˆGai Yangï¼‰ï¼‹Som Tamã€ç¾åˆ‡æ°´æœï¼ˆå­£ç¯€ï¼‰ã€æ¤°å­æ°´ã€‚\nã€ç­–ç•¥ã€‘ç†Ÿé£Ÿæ”¤äººå¤šå°±è·Ÿè‘—è²·ã€‚',
          afterTime: '13:30'
        },
        {
          place: { name:'Chatuchak å‘¨é‚Šå°é¤¨ï¼ˆå‚™ç”¨ï¼‰', q:'Chatuchak restaurant', note:'å‚™æ¡ˆï½œè‹¥å¸‚å ´å¤ªæ“ æƒ³åä¸‹ä¾†' },
          d: 'ã€å¿…é»ã€‘æ‰“æ‹‹è±¬ã€ç¶ å’–å“©é›ã€Pad Thaiã€‚\nã€ç­–ç•¥ã€‘åä¸‹åƒã€å¿«é€Ÿæ’¤é€€ã€‚',
          afterTime: '13:30'
        }
      ],
      dinner: [
        {
          place: { name:'Pier 21ï¼ˆTerminal 21 ç¾é£Ÿè¡—ï¼‰', q:'Pier 21 Terminal 21', note:'ä¸»é¸ï½œé›¢å¢ƒå‰ CP å€¼ä¹‹ç‹' },
          d: 'ã€å¿…é»ã€‘æ‰“æ‹‹è±¬é£¯ã€Pad Thaiã€è±¬è…³é£¯ï¼ˆKha Mooï¼‰ã€æ³°å¥¶ã€‚\nã€å„ªé»ã€‘ä¾¿å®œå¿«ã€æ¡è²·ä¹Ÿé †è·¯ã€‚',
          afterTime: '18:00'
        },
        {
          place: { name:'BKK æ©Ÿå ´ Food Courtï¼ˆå‚™ç”¨ï¼‰', q:'Suvarnabhumi Airport food court', note:'å‚™æ¡ˆï½œæ™‚é–“å¤ªè¶•å°±ä¸è¦ç¹è·¯' },
          d: 'ã€å¿…é»ã€‘ç°¡å–®æ¹¯éºµ/å’–å“©é£¯ï¼‹é£²æ–™ã€‚\nã€ç­–ç•¥ã€‘ä¿å‘½ç”¨ï¼Œä¸è¿½ååº—ã€‚',
          afterTime: '20:45'
        }
      ]
    }
  }
];

/* ======================
   State
====================== */
let currentDayId = 2;

/* ======================
   Utilities
====================== */
const toast = (msg, ms = 1600) => {
  const el = document.getElementById('toast');
  el.textContent = msg;
  el.style.display = 'block';
  clearTimeout(toast._t);
  toast._t = setTimeout(()=>{ el.style.display='none'; }, ms);
};

const copyText = async (text) => {
  try{
    await navigator.clipboard.writeText(text);
    toast('å·²è¤‡è£½');
  }catch(e){
    // fallback
    const ta = document.createElement('textarea');
    ta.value = text;
    document.body.appendChild(ta);
    ta.select();
    document.execCommand('copy');
    ta.remove();
    toast('å·²è¤‡è£½');
  }
};

// ===== Safe HTML helpers =====
const escapeHtml = (s='') =>
  String(s).replaceAll('&','&amp;')
           .replaceAll('<','&lt;')
           .replaceAll('>','&gt;')
           .replaceAll('"','&quot;')
           .replaceAll("'","&#39;");

const escapeAttr = (s='') =>
  String(s).replaceAll('&','&amp;')
           .replaceAll('"','&quot;')
           .replaceAll("'","&#39;")
           .replaceAll('<','&lt;')
           .replaceAll('>','&gt;')
           .replaceAll('\n','\\n');

/* ======================
   Place registry (avoid inline onclick objects)
====================== */
const placeRegistry = Object.create(null);
let placeSeq = 1;

const registerPlace = (p) => {
  const base = (p?.q || p?.name || '').trim() || ('p' + placeSeq);
  const key = 'p_' + btoa(unescape(encodeURIComponent(base))).slice(0,18).replaceAll('=','') + '_' + (placeSeq++);
  placeRegistry[key] = p;
  return key;
};

/* ======================
   Time helpers for "Mode B" (prev stop by meal)
====================== */
const timeToMin = (t) => {
  if(!t) return null;
  const m = String(t).match(/^(\d{1,2}):(\d{2})$/);
  if(!m) return null;
  const hh = Number(m[1]), mm = Number(m[2]);
  return hh * 60 + mm;
};

// Find last timeline stop where stop.time <= afterTime
const getPrevStopByMeal = (dayObj, afterTime) => {
  if(!dayObj?.timeline?.length) return null;
  const target = timeToMin(afterTime);
  if(target == null) return dayObj.timeline[0];

  let best = null;
  for(const s of dayObj.timeline){
    const tm = timeToMin(s.time);
    if(tm == null) continue;
    if(tm <= target) best = s;
  }
  return best || dayObj.timeline[0];
};

/* ======================
   Rendering
====================== */
const renderAll = () => {
  // day buttons
  const daylist = document.getElementById('daylist');
  daylist.innerHTML = itinerary.map(d => `
    <div class="daybtn ${d.id === currentDayId ? 'active' : ''}" onclick="selectDay(${d.id})">
      <strong>${d.day}</strong><small>${d.date}</small>
    </div>
  `).join('');

  const d = itinerary.find(x => x.id === currentDayId);
  document.getElementById('mainTitle').textContent = `${d.day}ï½œ${d.title}`;
  document.getElementById('mainNote').textContent = d.note;

  // Timeline
  let html = `
    <div class="section-header">
      <div class="dot" style="background:rgba(31,154,168,0.95)"></div>
      <span>ğŸ“ æ™¯é»å°èˆªï¼ˆé»å¡ç‰‡ â†’ Google Mapsï¼‰</span>
    </div>
    <div class="timeline">
  `;
  d.timeline.forEach(it => {
    const mapsUrl = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(it.what)}`;
    html += `
      <a href="${mapsUrl}" target="_blank" rel="noopener" class="item-card">
        <div class="item-content">
          <div class="time-tag">${it.time}</div>
          <div class="what">
            <div class="w">${escapeHtml(it.what)}</div>
            <div class="d">${escapeHtml(it.desc)}</div>
          </div>
        </div>
        <div class="item-footer">é»æ“Šå¡ç‰‡é–‹å•Ÿå°èˆª â†—</div>
      </a>
    `;
  });
  html += `</div>`;

  // Transport
  html += `
    <div class="section-header">
      <div class="dot" style="background:rgba(201,162,39,0.95)"></div>
      <span>ğŸšŒ äº¤é€šè½‰ä¹˜ç´°ç¯€</span>
    </div>
    <div class="trans-steps">
      <div style="padding:14px 16px 6px; font-size:12px; font-weight:950; color:rgba(31,154,168,0.98)">${escapeHtml(d.transport.headline)}</div>
      ${d.transport.steps.map((s, i) => `
        <div class="t-step">
          <div class="t-n">${i+1}</div>
          <div class="t-txt"><span class="a">${escapeHtml(s.a)}</span><span class="b">${escapeHtml(s.b)}</span></div>
        </div>
      `).join('')}
    </div>
  `;

  // Meals (SAFE: mobile friendly + Mode B meta)
  html += `
    <div class="section-header">
      <div class="dot" style="background:rgba(180,35,24,0.95)"></div>
      <span>ğŸœ é¤é»ï¼ˆé»åº—å â†’ Sheet â†’ å¾ä¸Šä¸€ç«™å°èˆªï¼‰</span>
    </div>
    <div class="meals-grid">
  `;

  const mTypesFixed = [
    {t:'æ—©é¤', k:'breakfast', c:'rgba(31,154,168,0.95)'},
    {t:'åˆé¤', k:'lunch', c:'rgba(201,162,39,0.95)'},
    {t:'æ™šé¤', k:'dinner', c:'rgba(180,35,24,0.95)'}
  ];

  mTypesFixed.forEach(m => {
    html += `
      <div class="meal-box">
        <div class="meal-type" style="background:${m.c}">${m.t}</div>
        <ul>
    `;

    (d.meals[m.k] || []).forEach(item => {
      const p = item.place || { name: item.n || '', q: item.q || item.n || '', note: '' };
      const key = registerPlace(p);

      const summary = (item.d || '').split('\n')[0].trim();
      const summaryHtml = summary ? `<div class="d">${escapeHtml(summary)}</div>` : '';

      html += `
        <li>
          <span class="meal-item-link"
                data-action="open-meal"
                data-placekey="${key}"
                data-desc="${escapeAttr(item.d || '')}"
                data-aftertime="${escapeAttr(item.afterTime || '')}"
                data-mealtype="${escapeAttr(m.k)}">
            ${escapeHtml(p.name || 'ï¼ˆæœªå‘½åï¼‰')}
          </span>
          ${summaryHtml}
        </li>
      `;
    });

    html += `</ul></div>`;
  });

  html += `</div>`;

  document.getElementById('content').innerHTML = html;

  // update today hint
  document.getElementById('todayHint').textContent = `ï¼ˆ${getTodayDayLabel()}ï¼‰`;
};

/* ======================
   Interactions
====================== */
window.selectDay = (id) => { currentDayId = id; renderAll(); };

window.closeSheet = () => {
  document.getElementById('sheet').classList.remove('show');
  document.getElementById('overlay').classList.remove('show');
};

window.openMeal = (placeObj, desc, meta = {}) => {
  const d = itinerary.find(x => x.id === currentDayId);
  const prevStop = getPrevStopByMeal(d, meta.afterTime);
  const origin = prevStop?.what || '';
  const dest = placeObj?.q || placeObj?.name || '';

  const searchUrl = dest
    ? `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(dest)}`
    : '';

  const dirUrl = dest
    ? `https://www.google.com/maps/dir/?api=1&destination=${encodeURIComponent(dest)}&travelmode=transit`
    : '';

  const dirFromPrevUrl = (origin && dest)
    ? `https://www.google.com/maps/dir/?api=1&origin=${encodeURIComponent(origin)}&destination=${encodeURIComponent(dest)}&travelmode=transit`
    : '';

  document.getElementById('sheetTitle').textContent = placeObj?.name || 'ç¾é£Ÿ';
  document.getElementById('sheetDesc').textContent =
    (desc || '') + (placeObj?.note ? `\n\nã€å‚™è¨»ã€‘${placeObj.note}` : '') +
    (origin ? `\n\nã€ä¸Šä¸€ç«™ã€‘${origin}${meta.afterTime ? `ï¼ˆâ‰¤ ${meta.afterTime}ï¼‰` : ''}` : '');

  const btns = [];
  if(dirFromPrevUrl) btns.push(`<a class="primary" href="${dirFromPrevUrl}" target="_blank" rel="noopener">å¾ä¸Šä¸€ç«™å°èˆª</a>`);
  if(dirUrl) btns.push(`<a href="${dirUrl}" target="_blank" rel="noopener">å°èˆª</a>`);
  if(searchUrl) btns.push(`<a href="${searchUrl}" target="_blank" rel="noopener">æŸ¥çœ‹</a>`);
  if(dest) btns.push(`<button onclick="copyText('${escapeAttr(dest)}')">è¤‡è£½é—œéµå­—</button>`);

  document.getElementById('sheetBtns').innerHTML = btns.join('');

  document.getElementById('sheet').classList.add('show');
  document.getElementById('overlay').classList.add('show');
};

window.handleSearch = () => {
  const q = document.getElementById('q').value.trim().toLowerCase();
  if(!q){ renderAll(); return; }

  // Find day by day/title
  let found = itinerary.find(d =>
    d.day.toLowerCase().includes(q) ||
    d.title.toLowerCase().includes(q) ||
    d.date.toLowerCase().includes(q)
  );

  // Find within timeline
  if(!found){
    found = itinerary.find(d => d.timeline.some(t =>
      (t.what||'').toLowerCase().includes(q) ||
      (t.desc||'').toLowerCase().includes(q)
    ));
  }

  // Find within meals
  if(!found){
    found = itinerary.find(d => {
      const allMeals = [...(d.meals.breakfast||[]), ...(d.meals.lunch||[]), ...(d.meals.dinner||[])];
      return allMeals.some(m =>
        (m.place?.name || '').toLowerCase().includes(q) ||
        (m.place?.q || '').toLowerCase().includes(q) ||
        (m.d || '').toLowerCase().includes(q)
      );
    });
  }

  if(found){
    currentDayId = found.id;
    renderAll();
  }else{
    toast('æ‰¾ä¸åˆ°ç¬¦åˆçš„å…§å®¹');
  }
};

/* ======================
   Today mode (based on local date in Asia/Taipei)
   This trip is Feb 9â€“13. We'll map:
   Feb 9 -> Day1, Feb 10 -> Day2, Feb 11 -> Day3, Feb 12 -> Day4, Feb 13 -> Day5
====================== */
const getTodayDayLabel = () => {
  const now = new Date();
  const m = now.getMonth() + 1;
  const d = now.getDate();
  return `${m}/${d}`;
};

window.goToday = () => {
  const now = new Date();
  const m = now.getMonth() + 1;
  const d = now.getDate();
  // match 2/9..2/13
  const map = { '2/9': 1, '2/10': 2, '2/11': 3, '2/12': 4, '2/13': 5 };
  const key = `${m}/${d}`;
  const id = map[key];
  if(id){
    currentDayId = id;
    renderAll();
    toast(`ä»Šå¤©æ¨¡å¼ï¼š${itinerary.find(x=>x.id===id).day}`);
  }else{
    toast('ä»Šå¤©ä¸åœ¨æ­¤è¡Œç¨‹æ—¥æœŸç¯„åœï¼ˆ2/9â€“2/13ï¼‰');
  }
};

/* ======================
   Event delegation for meal clicks (mobile-safe)
====================== */
document.addEventListener('click', (e) => {
  const el = e.target.closest('[data-action="open-meal"]');
  if(!el) return;

  const key = el.getAttribute('data-placekey');
  const desc = (el.getAttribute('data-desc') || '').replaceAll('\\n','\n');
  const afterTime = el.getAttribute('data-aftertime') || '';
  const mealType = el.getAttribute('data-mealtype') || '';
  const placeObj = placeRegistry[key];

  if(placeObj){
    window.openMeal(placeObj, desc, { afterTime, mealType });
  }else{
    toast('æ‰¾ä¸åˆ°è©²ç¾é£Ÿè³‡æ–™ï¼ˆè«‹é‡æ–°æ•´ç†é é¢ï¼‰');
  }
});

window.onload = renderAll;
</script>
</body>
</html>
